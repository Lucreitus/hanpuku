<!doctype html>
<html>
    <head>
        <link type="text/css" rel="stylesheet" href="style.css"/>
    </head>
    <body>
        <div id="quickies">
            <h2 class="dontmove">Quick Links</h2>
            <ul>
                <li><h3><a href="samples.html">iD3 Examples</a></h3></li>
                <li><h3><a href="http://bl.ocks.org/mbostock">Mike Bostock's D3 Examples</a></h3>
                <small>(May need a little hacking to work)</small></li>
                <li><h3><a href="https://github.com/mbostock/d3/wiki/Gallery">D3 Example Gallery</a></h3>
                <small>(May need more than a little hacking to work)</small></li>
            </ul>
            
        </div>
        <div id="column">
            <h2>Not a programmer?</h2>
            <p>Try loading an existing chart from our <a href="samples.html">sample library</a>. If you
            paste similar data into the Data tab, you can just press "Run" in the JS tab and see the graph
            with your data in it. Click "Apply" to save your changes.</p>
            <p>Need to change the data? Even after you've changed stuff with Illustrator tools? No problem! Just
            change the data in the Data tab, and pres "Run" in the JS tab to update everything.</p>
            <p>Of course, feel free to change things in the javascript or CSS if you're feeling adventurous. Nothing
            will change in your actual document until you click the "Apply" button. Many
            of <a href="http://bl.ocks.org/mbostock">Mike Bostock's D3 Examples</a> can be imported
            and work with only a few minor changes.</p>
            
            <h2>For programmers - Things to be aware of</h2>
            <p>There are several quirks for d3 code that are introduced by integrating
            d3.js with Illustrator. iD3 includes a DOM, rendered using Adobe's built-in,
            Google Chrome-based extension engine. The "Reset" button clears the DOM in iD3, and reverts
            the widget back to the current state of the Illustrator document. "Apply"
            maps any changes that have been made to the iD3 DOM to the currently active Illustrator document,
            and then updates the iD3 DOM to match the Illustrator document's state.</p>
            <p>These cycles between a real DOM and an Illustrator document have some nuances
            and speed bumps. Some functionality has been added to d3, and some additional
            global variables exist (see the list below). Some incompatibilities also exist
            in the conversion; hopefully this will get smoother with future updates, and
            Adobe's extension API expands.</p>
            <p>In the mean time, I have listed all the difficulties you are likely to
            encounter in the conversion.</p>
            
            <h2>Included libraries</h2>
            <p>I plan to add a mechanism for adding your own javascript libraries in the future. In the mean
            time, here are the ones that are included:</p>
            <ul>
                <li>d3.js</li>
                <li>id3.js (adds functionality listed below)</li>
                <li>topojson.js</li>
                <li>jQuery</li>
            </ul>
            <p>Beyond this, iD3 currently only supports a single javascript file (in the JS tab). I plan to
            organize this a little better in the future as well.</p>
            
            <h2>Limitations, Added functionality</h2>
            <ul>
                <li><h3>DOM Structure</h3><br/>
                    <p>A fresh iD3 DOM will always contain an inline SVG element whose id matches the
                    file name of the current Illustrator document. Any changes outside this
                    SVG element will be ignored (if, for example, you add buttons to control
                    an interactive visualization, they will be lost after clicking "Apply").
                    exist in the DOM, with its id matching the document name. Its immediate
                    children are:</p>
                    <ul>
                        <li>rect elements of class "artboard"<br/></li>
                        <li>g elements representing each layer<br/></li>
                    </ul>
                    <p>Every element's id in the DOM will be the same as the object's
                    name in Illustrator's Layers widget, however, iD3 may modify
                    these names to ensure that all ids are unique and compatible with HTML.</p>
                    <p>You can manipulate the .artboard elements, and your changes
                    will be reflected in the document, however, Illustrator does not have a mechanism
                    for embedding d3 data or transform or class attributes in Layer groups.
                    <b>Any attributes applied to a Layer group will be lost
                    once "Apply" is clicked.</b></p>
                </li>
                <li><h3>Global variables</h3><br/>
                    <p>You can both use and modify the selectedIDs variable. This is an array containing
                    all the ids of elements that are selected in the current document. Any changes to
                    this array will change the Illustrator selection when you click the "Apply" button.</p>
                </li>
                <li><h3>Additional d3 Functions: Cubic Interpolated Paths</h3><br/>
                    <p>Illustrator only supports cubic-interpolated path elements. On clicking the "Apply"
                    button, iD3 must convert every SVG primitive in
                    its DOM to cubic-interpolated paths; while class and style attributes will be
                    preserved in the converted path, its identity as a circle, rect, or non-cubic path
                    will be lost. To allow free manipulation of primitives in Illustrator, these
                    semantics can not be hidden from the d3 code.</p>
                    <p>In some situations, this can make for confusing update code; to mitigate this
                    a little, we have monkey-patched
                    these functions onto d3 selections that do the conversion immediately instead of
                    waiting for "Apply":</p>
                    <ul>
                        <li>
                            <p><strong>d3.selection.appendCircle(cx, cy, r);</strong> Equivalent to:<br/>
                            d3.selection.append('circle')<br/>
                            &emsp;.attr('cx', cx)<br/>
                            &emsp;.attr('cy', cy)<br/>
                            &emsp;.attr('r', r);<br/>
                            except a cubic-interpolated path is created instead of a circle element.</p>
                        </li>
                        <li>
                            <p><strong>d3.selection.appendRect(x, y, width, height);</strong> Equivalent to:<br/>
                            d3.selection.append('rect')<br/>
                            &emsp;.attr('x', x)<br/>
                            &emsp;.attr('y', y)<br/>
                            &emsp;.attr('width', width)<br/>
                            &emsp;.attr('height', height);<br/>
                            except a cubic-interpolated path is created instead of a rect element.</p>
                        </li>
                        <li>
                            <p><strong>d3.selection.appendPath(d);</strong> Equivalent to:<br/>
                            d3.selection.append('path')<br/>
                            &emsp;.attr('d', d);<br/>
                            except the d parameter is immediately converted to cubic-interpolated control points.</p>
                        </li>
                    </ul>
                    <p>As with any d3 function, each parameter may be a function instead of a value that
                    will be called with two parameters: the data element, and its index. Of course, SVG primitives
                    can still be added in the traditional way, but these may help make your code more consistent
                    after "Apply" has been
                    clicked.</p>
                    
                    TODO: .appendClone(), .appendCircle(), .appendRect(), .appendPath(), .toCubicPaths(),
                    .setGlobalPosition(), .setGlobalBBox(), .setGlobalTransform()
                </li>
                <li><h3>Additional d3 Functions: Absolute Coordinates</h3><br/>
                    <p>Illustrator only supports global coordinates (i.e. SVG-style nested transformations on
                    various groups can not be used). This is very problematic for perhaps the majority of
                    existing D3 code; nested transformations are used extensively. iD3 masks this process
                    from its DOM; when refreshing the DOM from the existing document, old tranformation tags
                    and local coordinates are reapplied where they previously existed.</p>
                    <p>That said, some nuances can still exist, especially if you plan on manipulating
                    drawn objects that did not previously have these attributes. To make iD3 code more
                    flexible to this, and to allow Illustrator-style edits with code,
                    we have monkey-patched these functions onto d3 selections:</p>
                    <ul>
                        <li>
                            <p><strong>d3.selection.setGlobalPosition(x, y, anchor);</strong><br/>
                            Aligns every element in the current selection to the specified global x,y coordinates,
                            where anchor is one of:
                            <ul>
                                <li>d3.ANCHORS.TOP_LEFT</li>
                                <li>d3.ANCHORS.TOP_CENTER</li>
                                <li>d3.ANCHORS.TOP_RIGHT</li>
                                <li>d3.ANCHORS.MIDDLE_LEFT</li>
                                <li>d3.ANCHORS.MIDDLE_CENTER</li>
                                <li>d3.ANCHORS.MIDDLE_RIGHT</li>
                                <li>d3.ANCHORS.BOTTOM_LEFT</li>
                                <li>d3.ANCHORS.BOTTOM_CENTER</li>
                                <li>d3.ANCHORS.BOTTOM_RIGHT</li>
                            </ul></p>
                        </li>
                        <li>
                            <p><strong>d3.selection.setGlobalBBox(x, y, width, height);</strong><br/>
                            Scales and translates every element in the current selection to fit exactly
                            in the specified rectangle (in global coordinates).</p>
                        </li>
                        <li>
                            <p><strong>d3.selection.setGlobalTransform(m);</strong><br/>
                            Applies a transformation matrix to every element in the selection AFTER first centering
                            the element on the document's 0,0 coordinate. Its parameter, m, is a 6-element matrix in
                            SVG order, e.g. a matrix that translates 5px in x and 10px in y would be [1,0,0,1,5,10].</p>
                        </li>
                        <li>
                            <p><strong>d3.selection.standardize();</strong><br/>
                            Makes the current selection immediately compatible with Illustrator; i.e. transform tags
                            are applied AND all primitives are immediately converted to cubic-interpolated paths.</p>
                        </li>
                    </ul>
                    <p>As with any d3 function, each parameter may be a function instead of a value that
                    will be called with two parameters: the data element, and its index.</p>
                </li>
                <li><h3>Text</h3>
                    <p>Adobe is famous for its abilities to handle text well, and SVG is notorious for not handling
                    it well. Translating between the two is very complex, and while it is at the top of my feature
                    list, it may take some time.</p>
                    <p>In the mean time, iD3 ignores text in the document, and does not yet add new text from the
                    DOM (sorry, I really will get on this soon!)</p>
                </li>
                <li><h3>Colors and Opacity</h3>
                    <p>Currently, most browsers (including Adobe's internal Chrome engine) do not yet support
                    CMYK colors in the DOM. On the flip side, Illustrator does not natively support web-style, hexidecimal
                    colors in documents. Furthermore, Illustrator does not support different opacity settings for stroke
                    and fill.</p>
                    <p>iD3's current solution is to convert all colors to rgb(0-255,0-255,0-255) format, and the separate
                    opacity CSS styles are used. Furthermore, CMYK Illustrator documents are not yet supported. These
                    compromises are obviously less than ideal, and will be addressed soon.</p>
                </li>
                <li><h3>Debugging</h3>
                    <p>I plan to embed Chrome's developer tools inside the widget when I can figure out how to do it
                    (iframe?). In the mean time, you can run Google Chrome outside Illustrator, and go to
                    http://localhost:8088. Unfortunately, this exposes the entire extension's DOM; for your purposes,
                    you will probably want to navigate here in the Elements tab:</p>
                    <ul>
                        <li>&lt;html&gt;</li>
                        <li>&lt;body onload="...</li>
                        <li>&lt;div id="domPreview" ...</li>
                        <li>&lt;div id="domPreviewContent" ...</li>
                        <li>&lt;iframe&gt;</li>
                        <li>#document</li>
                    </ul>
                    <p>As you can probably tell, the DOM you are manipulating is in an iframe; most of the iD3 extension
                    should be hidden from the immediate scope of your code. The d3 and jQuery objects will only reference
                    elements inside your DOM. To access this scope in the developer tools, select the about:blank frame
                    at the bottom:</p>
                    <img src="debug.png"/>
                </li>
            </ul>
        </div>
    </body>
</html>